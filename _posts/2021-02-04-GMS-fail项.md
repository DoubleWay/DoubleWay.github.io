---
layout:     post
title:      GMS-fail项
subtitle:   
date:       2021-02-04
author:     DoubleWay
header-img: img/home-bg-art.jpg
catalog: 	 true
tags:
    - GMS
    - TINNO
---

## GMS fail项

### CTS：

------

### GTS：

- **module：GtsNmgiarcTestCases**

   **test：com.google.android.comms.DialerTests#testDialerPreloadStatus**

  RLZ VALUE配置 （针对南非Mobicel所有项目；包含OM,MTN,VDC,CEC,HI等），南非项目gts出现这个fail项的话，需要配置属性值，这2个属性是 OEM跟谷歌签署的agreement相关的，不配置的话，会有fail。

  ro.com.google.rlz_ap_whitelist=YA
  ro.com.google.rlzbrandcode=MBCL

- **module：GtsSettingsTestCases**

  **test：com.google.android.settings.gts.MADAComplianceTest#testMADACompliance**

  这个是网络有关的，进去连了翻墙网络之后，到security下，点Google play protect进去scan下，出来之后Google play protect下有一行小字，测试过程中会跳转到about phone，要比较快速打开谷歌法律信息，都是自动的，取决于网络。

------

### STS：

- **module：CtsAppSecurityHostTestCases**

  **test：android.appsecurity.cts.PermissionsHostTest#testNoPermissionEscalationAfterReboot**

  Android 8.1 打上2021-02的补丁后，跑sts会出现这个reboot 权限的fail项，向展讯提case后，展讯提供了一个patch，合入后就pass了

  ```diff
  From 0ab531dd59584a48f5ef30f99591f7c096ae74bb Mon Sep 17 00:00:00 2001
  From: gang.huang <gang.huang@unisoc.com>
  Date: Wed, 03 Feb 2021 10:15:17 +0800
  Subject: [PATCH] Bug #1507166 CtsAppSecurityHostTestCases-android.appsecurity.cts.PermissionsHostTest#testNoPermissionEscalationAfterReboot fail
  [root cause  ] Before revoke runtime permission, install permission of the same name is not revoke
  [changes     ] Adjust the scanning order of data/app directory and preloadapp directory in PackageManagerService construction method
  [side effects]no
  [self test   ]:pass
  [download normally]:yes
  [power on/off normally]:yes
  [do common repository/branch inspection]:yes
  [is there dependence]:no
  [confirm dependent commit]:no
  [board]:7731
  [test case]:build
  [reviewers   ] bourne.wang
  [change_type ] feature_bugfix
  [tag_product ] common
  
  Change-Id: Ic51a1b56634fd1e252bcc86fe2b7f70ccca58ccf
  ---
  
  diff --git a/services/core/java/com/android/server/pm/PackageManagerService.java b/services/core/java/com/android/server/pm/PackageManagerService.java
  index d0f8b3e..4640f02 100644
  --- a/services/core/java/com/android/server/pm/PackageManagerService.java 
  
  +++ b/services/core/java/com/android/server/pm/PackageManagerService.java
@@ -2909,9 +2909,6 @@
                           ((int) systemScanTime) / systemPackagesCount);
               }
               if (!mOnlyCore) {
  -                EventLog.writeEvent(EventLogTags.BOOT_PROGRESS_PMS_DATA_SCAN_START, 
  
  -                        SystemClock.uptimeMillis()); 
  
  -                scanDirTracedLI(sAppInstallDir, 0, scanFlags | SCAN_REQUIRE_KNOWN, 0); 
   
                   scanDirTracedLI(sDrmAppPrivateInstallDir, mDefParseFlags
                           | PackageParser.PARSE_FORWARD_LOCK,
  @@ -2924,6 +2921,11 @@
                   scanDirLI(mPackageManagerServiceExUtils.mPreloadInstallDir, 0, scanFlags, 0);
                   /* @} */
   
  +                EventLog.writeEvent(EventLogTags.BOOT_PROGRESS_PMS_DATA_SCAN_START, 
  
  +                        SystemClock.uptimeMillis()); 
  
  + 
  
  +                scanDirTracedLI(sAppInstallDir, 0, scanFlags | SCAN_REQUIRE_KNOWN, 0); 
  
  + 
                   // Remove disable package settings for updated system apps that were
                   // removed via an OTA. If the update is no longer present, remove the
                   // app completely. Otherwise, revoke their system privileges.
  ```
  
  

